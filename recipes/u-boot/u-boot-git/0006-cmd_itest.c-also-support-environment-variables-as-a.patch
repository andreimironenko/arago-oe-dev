From 11e8b9d3df819406049b36bed2f3fcf43ddd7f12 Mon Sep 17 00:00:00 2001
From: Frans Meulenbroeks <fransmeulenbroeks@gmail.com>
Date: Wed, 24 Feb 2010 15:33:29 +0100
Subject: [PATCH] cmd_itest.c: also support environment variables as arguments

Signed-off-by: Frans Meulenbroeks <fransmeulenbroeks@gmail.com>
---
 common/cmd_itest.c |    8 ++++++++
 1 files changed, 8 insertions(+), 0 deletions(-)

diff --git a/common/cmd_itest.c b/common/cmd_itest.c
index 58c5e7b..78a4082 100644
--- a/common/cmd_itest.c
+++ b/common/cmd_itest.c
@@ -69,6 +69,10 @@ static long evalexp(char *s, int w)
 	long l = 0;
 	long *p;
 
+	/* if the parameter starts with a $ replace it with the environment value */
+	if (s[0] == '$') {
+		s = getenv(&s[1]);
+	}
 	/* if the parameter starts with a * then assume is a pointer to the value we want */
 	if (s[0] == '*') {
 		p = (long *)simple_strtoul(&s[1], NULL, 16);
@@ -86,6 +90,10 @@ static long evalexp(char *s, int w)
 
 static char * evalstr(char *s)
 {
+	/* if the parameter starts with a $ replace it with the environment value */
+	if (s[0] == '$') {
+		s = getenv(&s[1]);
+	}
 	/* if the parameter starts with a * then assume a string pointer else its a literal */
 	if (s[0] == '*') {
 		return (char *)simple_strtoul(&s[1], NULL, 16);
-- 
1.5.4.3

